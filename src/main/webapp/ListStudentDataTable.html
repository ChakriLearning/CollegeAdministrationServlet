<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student List Table</title>
    <style>
        /* CSS styles for the table and its rows */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #f61284;
        }

        tr:hover {
            background-color: #80ecd8; /* Change background color on hover */
        }

        /* CSS styles for the table header */
        th {
            background-color: #4CAF50; /* Green */
            color: #030000;
        }

        .top-right {
            position: absolute;
            top: 0;
            right: 0;
            padding: 10px;
            background-color: #f80e38;
            border: 1px solid #930ef3;
        }
    </style>
</head>
<body>
<div class="top-right">
    <h4>WelCome : <span id="userNameDisplay"></span></h4>
</div>
<br>
<script>
    fetch(`http://localhost:8081/CollegeAdministrationServlet/login`)
        .then(response => response.json())
        .then(data => {
            const userName = data.username;
            document.getElementById('userNameDisplay').innerText = "User : " + userName;
            const addStudentLink = document.createElement('a');
            addStudentLink.href = "AddStudentData.html";
            addStudentLink.innerHTML = "<h3>Add New Student</h3>";
            document.body.appendChild(addStudentLink);
        })
        .catch(error => console.error('Error fetching JSON data:', error));
</script>
<!--creating the div elements with id attribute ='student-list' used to display the list-->
<div id="student-list"></div>
<!-- call login servlet --> <!-- and display the userName right-top-->
<script>
    fetch('http://localhost:8081/CollegeAdministrationServlet/student')
        .then(response => response.json())  //get json data from the server's response
        .then(data => {//actual json data we received from the server
            console.log(data);
            let studentListDiv = document.getElementById('student-list');

            // Creating a table element dynamically;
            let table = document.createElement('table');
            table.border = "1";

            //
            // Creating  table header dynamically
            let thead = document.createElement('thead');
            //creating the table row;
            let headerRow = document.createElement('tr');
            // printing table head,column
            headerRow.innerHTML = `
                    <th>RollNo</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>PhoneNo</th>
                    <th>Actions</th>
                `;
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Create table body
            let tbody = document.createElement('tbody');
            data.forEach(student => {
                let row = document.createElement('tr');
                row.innerHTML = `
                        <td>${student.rollNo}</td>
                        <td>${student.name}</td>
                        <td>${student.age}</td>
                        <td>${student.phoneNo}</td>
                         <td>
        <a href="UpdateStudentData.html?rollNo=${student.rollNo}">Edit</a> |
       <a href="#" class="delete-link" data-rollno="${student.rollNo}" data-name="${student.name}" data-age="${student.age}" data-phoneNo="${student.phoneNo}"">Delete</a> |
        <a href="GetStudentData.html?rollNo=${student.rollNo}">View</a>
    </td>
                    `;
                tbody.appendChild(row);  //appending each row to <tbody> element
            });
            table.appendChild(tbody); //appending all the row's to the <table>

            // Append the table to the student list div
            studentListDiv.appendChild(table);
            // Add event listeners for delete links
            document.querySelectorAll('.delete-link').forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    const rollNo = this.getAttribute('data-rollno');
                    const name = this.getAttribute('data-name');
                    const age = this.getAttribute('data-age');
                    const phoneNo = this.getAttribute('data-phoneNo');
                    const username = this.getAttribute('username');
                    if (confirm(`Are you sure you want to delete student with Roll No : ${rollNo}.    having   Name : ${name}    age : ${age}   phoneNo : ${phoneNo}`)) {
                        window.location.href = "DeleteStudentData.html?rollNo=" + rollNo;
                    }
                });
            });
        })
        .catch(error => console.error('Error fetching JSON data:', error));
</script>
</body>
</html>
